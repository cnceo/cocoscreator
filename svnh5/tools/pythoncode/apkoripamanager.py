# coding=utf-8#混淆代码#秘钥SL_CODE_KEY ="WeAreTheWorld"; SL_CODE_SIGN ="KING";import os,os.path;from biplist import *;import time;import tool;import xlsdic;import sys;import re;import zipfile;reload(sys);sys.setdefaultencoding( "utf-8" );import json;import urllib2;os.chdir("..");#表示上级目录import urllib;f=urllib.urlopen("http://192.168.1.254:1997/pythonclient?opid=getcfg");totalConf=json.loads(f.read()); lang_conf_name="lang_conf";proj_conf_name="proj_conf";net_conf_name="net_conf";channel_conf_name="channel_conf"; lang_conf=totalConf[lang_conf_name];channel_conf=totalConf[channel_conf_name];proj_conf=totalConf[proj_conf_name]; projname=os.getcwd();flag1=projname.rindex('\\');popdir= projname[0:flag1+1];packetDir = popdir +"fsdzzPacket"; def _mkdir(dir):	if(not os.path.exists(dir)):		os.mkdir(dir);class Cls:	def getData(self,z,settingfilename):		for filename in z.namelist(  ):				filepos=filename.find(settingfilename);				if len(filename)-filepos==len(settingfilename):					content=z.read(filename);					return content;	def dealWithApk(self):		packname=self.packname;		localsetting_cfg=self.localsetting_cfg;		tail=packname[len(packname)-4:len(packname)];		_mkdir(packetDir);		newpackname="fsdzz_"+self.proj_item['macro']+"_"+time.strftime('%Y_%m_%d_%H_%M') + tail;		newname=packetDir+"/"+newpackname;		print(u"包名是"+newpackname);		input=file(packname,"rb");		print(u"正在复制"+packname);		data=input.read();		input.close();		print(u"正在生成"+newname);		output=file(newname,"wb");		output.write(data);		output.close();		print(u"创建成功"+newname);		os.system("explorer.exe " + packetDir);		self.checkFile();	def choseMacros(self):		#显示工程宏		selectarr=[];		index=0;		while(1): 			print(u"xxxxxxxxxxxxxxxxxxx请问你当前的工程宏是xxxxxxxxxxxxxxxxxxxx");			for k,v in proj_conf.iteritems():				selectarr.append(v);				index=index+1;				print("%-2d"%(index)+"%-20s"%(v['macro'])+"%-24s"%(v['content'].decode('utf-8')));			print(u"请输入数字选择打包目标");			a=raw_input();			index=int(a)-1;			self.proj_item=selectarr[index];			self.choseChannel();			break;	def choseChannel(self):		#显示工程宏		selectarr=[];		index=0;		while(1): 			print(u"xxxxxxxxxxxxxxxxxxx请问要把包发往哪个发行商xxxxxxxxxxxxxxxxxxxx");			for k,v in channel_conf.iteritems():				selectarr.append(v);				index=index+1;				print("%-2d"%(index)+"%-20s"%(v['name'].decode('utf-8'))+"%-24s"%(v['company'].decode('utf-8'))+"%-24s"%(v['area'].decode('utf-8')));			print(u"请输入数字选择打包目标");			a=raw_input();			index=int(a)-1;			self.channel_item=selectarr[index];			self.dealWithApk();			break;	def checkFile(self):		while(1):			print(u"请将apk或ipa拉到此处，并按确认键,按q返回上一级");			packname=raw_input();			if packname=='q':				break;			z = zipfile.ZipFile(packname, "r");			content=self.getData(z,"localsetting.json");			print(content);			localsetting_cfg=json.loads(content);			tags=[u"#关闭",u"开启"];			print(u"#新手引导开关:"+tags[localsetting_cfg['dev_enable']])			print(u"#语言:"+lang_conf[localsetting_cfg['lang_id']]['des']);			print(u"#打印日志:"+tags[localsetting_cfg['log_enable']]);			print(u"#显示帧率:"+tags[localsetting_cfg['show_fps']]);			print(u"#带公司logo:"+tags[localsetting_cfg['show_logo']]);			print(u"#显示按钮绑定标记:"+tags[localsetting_cfg['show_bindtag']]);			if localsetting_cfg['datapack']['version']>0:				print(u"#本包带有谷歌数据包");			else:				print(u"#本包无谷歌数据包");			print(u"开发标签是:"+localsetting_cfg['devmode']);			mainluadata=self.getData(z,"main.lua");			#先判断是否混淆过了 			datalen = len(mainluadata);			datalen = len(mainluadata);				if datalen>len(SL_CODE_SIGN):				checksign=mainluadata[0:len(SL_CODE_SIGN)];				if checksign==SL_CODE_SIGN:					print(u"#代码已混淆");				else:					print(u"#代码未混淆");			print(u"------------温馨提示-------------");			print(u"如果正式包,请确保新手引导,日志打印,显示帧率是关闭的");			print(u"如果是韩国版的，请确认语言");			print(u"如果是给谷歌平台的，请确认是否有数据包");			z.close();			self.packname=packname;			self.localsetting_cfg=localsetting_cfg;			self.choseMacros();			break;cls = Cls();cls.checkFile();